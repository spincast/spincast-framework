{#==========================================
Docs : "overview"
==========================================#}

<section id="overview">
    <h3>
        <a class="anchor" href="#overview" title="permanent link"></a>
        Spincast overview
    </h3>

    {#==========================================
    Section "overview / introduction"
    ==========================================#}
    <div id="introduction">
        <h4>
            <a class="anchor_small" href="#introduction" title="permanent link"></a>
            Introduction
        </h4>
        <p>
            Spincast is based on the shoulders of a giant, <a href="https://github.com/google/guice/wiki/Motivation">Guice</a>
            (from Google).
            Other Java web frameworks may claim they <em>support</em> Guice, and maybe even have a
            section of their documentation dedicated to the topic. Spincast is one of those that is <em>totally</em> built on
            Guice, from the ground up! If you already know Guice, Spincast will be really easy to grasp for you.
        </p>
        <p>
            Guice is not only (in our opinion) the best dependency injection library of the Java ecosystem, but also a
            fantastic base to build modular applications. Everything is divided into <code>modules</code> which
            are swappable and overridable. Each module can declare which dependencies it requires from other
            modules. In fact, Guice is so flexible that you may even find ways of using Spincast we haven't think about!
        </p>
        <p>
            If you know another dependency injection library, like <a href="https://spring.io">Spring</a>, it can also help but 
            you'll probably have to learn one of two new tricks!
        </p> 
        <div class="archZoom">
            <p>
                <i class="subIcon glyphicon glyphicon-share-alt"></i> 
                Here's what using Spincast looks like at a very high level:
            </p>
            <p class="center">
                <img src="/public/images/arch/architecture_01a.png" />
            </p>
            <p>
                Users make requests to your web application. This application can
                have an <code>HTML</code> interface, built using popular tools like
                <a href="https://jquery.com">jQuery</a>, <a href="https://facebook.github.io/react">React</a>,
                <a href="http://emberjs.com">Ember</a>, <a href="https://angularjs.org">Angular</a>, etc. That
                <code>HTML</code> interface can be generated by Spincast (using a built-in templating engine) or
                can be a <code>Single Page Application</code> where Spincast is used as a bootstrapper and a
                data provider (<code>JSON</code> or <code>XML</code>) for the SPA.
            </p>
            <p>
                <i class="subIcon glyphicon glyphicon-share-alt"></i> 
                Spincast is also a good platform to build <code>REST</code> web services or <code>microservices</code>,
                without any user interface, since it "talks" <code>JSON</code> and <code>XML</code> natively.
            </p>
            <p class="center">
                <img src="/public/images/arch/architecture_01b.png" />
            </p>   
        </div> 
    </div>

    
    {#==========================================
    Section "architecture / architecture"
    ==========================================#}
    <div id="architecture">
        <h4>
            <a class="anchor_small" href="#architecture" title="permanent link"></a>
            Architecture
        </h4>
        <p>
            The core of a Spincast application is its <code>Guice modules</code>. Most of the time, your
            application's main Guice module will extend the default <code>SpincastDefaultGuiceModule</code>,
            so you start with a default implementation for all the required components, and not from scratch. Many
            components are provided by the various <a href="/plugins"><code>plugins</code></a>,
            but your application will also bind business logic components specific to it: 
            <code>controllers</code>, <code>services</code>, etc.
        </p>
        <p class="center">
            <img src="/public/images/arch/code_structure.png" />
        </p>
        <p>
            As you can see : 
            <ul>
                <li>
                    Spincast's top Guice module is <code>SpincastCoreGuiceModule</code>. This core module is provided 
                    by the <code>spincast-core</code> Maven artifact. It binds a couple of components (mostly the <code>front controller</code>),
                    but its main job is to validate that implementations for all the required components have been bound by
                    the other modules. A Spincast application is made of multiple Guice modules and each of them can validate
                    that some required bindings have been done by other modules, or else they can throw an exception.
                    <br />
                    The interfaces for the required components are also bundled in the <code>spincast-core</code> Maven artifact.
                </li>
                <li>
                     The other big part of Spincast is the various <a href="/plugins"><code>plugins</code></a>. Plugins can provide an 
                     implementation for a required component, but can also provide extra components to add functionalities. 
                     Most of the time, a <code>plugin</code> has its own Guice module which you have to install to activate the plugin.
                </li>
                <li>
                    <code>SpincastDefaultGuiceModule</code> is a Guice module provided by the <code>spincast-default</code> Maven artifact.
                    Its only job is to install some plugins so a <em>default</em> implementation is provided for all the required components.
                    Except if you really need <em>full</em> control over all the implementations which are actually bound, you 
                    would probably start with that default Guice module instead of the <code>core</code> one. You can
                    still tweak/override what is bound, but at least you do not start from scratch.
                </li>
                <li>
                    Finally, you have your application's own Guice module (here we called it <code>AppGuiceModule</code>). In this module,
                    you can override some default bindings. The best example of this would be to override the implementation
                    of the <code>ISpincastConfig</code> component so you can change the <em>port</em> the server will be running on.
                    Of course, in this module, you're also going to bind your application specific components: the controllers, 
                    the services, etc. Since all this is standard Guice development, make sure you read 
                    <a href="https://github.com/google/guice/wiki/GettingStarted">Guice documentation</a> if you have questions about the modules,
                    the bindings and the injection of dependencies!
                </li>
            </ul>   
        </p> 
    </div>

    {#==========================================
    Section "architecture / request handling"
    ==========================================#}
    <div id="request_handling">
        <h4>
            <a class="anchor_small" href="#request_handling" title="permanent link"></a>
            Request handling
        </h4>
        <p>
            Now that we have an idea on how is structured a Spincast application, let's see how it handles requests
            and what are the components involved.
        </p>
        <div class="archZoom">
            <p class="center">
                <img src="/public/images/arch/architecture_02a.png" />
            </p>

            <p>
                <i class="subIcon glyphicon glyphicon-share-alt"></i>
                First, the embedded HTTP <code>Server</code> receives a request. This server consists of an <code>IServer</code> interface and an
                implementation. The default implementation is provided by 
                the <a href="/plugins/spincast-undertow"><code>spincast-plugins-undertow</code></a>
                plugin which uses the <a href="http://undertow.io">Undertow</a> server.
            </p>
            <p>
                If the request is for a  <a href="#static_resources"><code>static resource</code></a>, the server serves it directly without even reaching the
                framework. Note that it's also possible to always generate the resource, using a standard route, so the request <em>does</em>
                enter the framework. There is even a third option which is what we call 
                <a href="#dynamic_resources"><code>dynamic resources</code></a>:
                if a request is made for a request which is not found, the server will pass the request to the framework. The
                framework can then create the resource and return it. The following requests for the same resource will use
                the generated resource and won't reach the framework anymore!
            </p>
            <p>
                <i class="subIcon glyphicon glyphicon-share-alt"></i>
                If the request is not for a <code>static resource</code>, the server passes it to the first true
                Spincast component: the <code>front controller</code>. The <code>front controller</code> is at the very center
                of Spincast! This is one of the very few components which is not provided by a <code>plugin</code>, but
                that is actually included in the <code>spincast-core</code> Maven artifact itself. Note that you still <em>can</em> extend the default
                <code>front controller</code> and override some of its methods, though, if you need to tweak one thing or two. 
            </p>
            <p>
                The job of the <code>front controller</code> is to:
                <ul>
                    <li>
                        Ask the <code>router</code> for the appropriate route to use when a request arrives.
                    </li>
                    <li>
                        Call the <code>route handlers</code> of the matching route. A route can have many handlers:
                        some <code>filters</code> which are run <em>before</em> the <code>main handler</code>, the <code>main handler</code>
                        itself, and some <code>filters</code> which are run <em>after</em> the <code>main handler</code>.
                    </li>
                    <li>
                        If no matching route is returned by the <code>router</code>, the <code>front controller</code> 
                        will use a <code>Not Found route</code>. The <code>Not Found route</code> can be a custom
                        one specified by the developer, or the default one.
                    </li>
                    <li>
                        If any exception occures during any of those steps, the <code>front controller</code> 
                        will use an <code>Exception route</code>. The <code>Exception route</code> can be a custom
                        one specified by the developer, or the default one.
                    </li>
                </ul>
            </p>
            <p>
                <i class="subIcon glyphicon glyphicon-share-alt"></i>
                The job of the <code>router</code> (interface <code><em>IRouter</em></code>) is to determine the appropriate 
                route to use, given the URL of the request, its <code>HTTP method</code>, etc. It will also
                extract the value of the dynamic path tokens, if any. For example, a route path could be
                <code>/user/${userId}/tasks</code>. If a <code>/user/42/tasks</code> request is made, the router will
                extract "<em>42</em>" as the value of the <code>userId</code> parameter and make this available to the rest of the
                framework.
            </p>
            <p>
                <i class="subIcon glyphicon glyphicon-share-alt"></i>
                Finally, the <code>route handlers</code> receive a <code>request context</code> reprensenting the request,
                and decide what to return as the response. This can be anything: <code>Json</code>, <code>HTML</code>,
                <code>XML</code> or even <code>bytes</code>.
            </p>
        </div>
    </div>
    
    {#==========================================
    Section "architecture / Required components and their default implementations"
    ==========================================#}
    <div id="required_components">
        <h4>
            <a class="anchor_small" href="#required_components" title="permanent link"></a>
            The required components and their default implementations
        </h4>
        <p>
            The <em>required components</em> are those without which a Spincast application can't run. 
            Any code, any <code>plugin</code>, can assume those components are available, so they can 
            inject them and use them! Spincast's <code>core</code> Guice module validates that an implementation
            for those components is actually bound and, if not, it throws an exception.
        </p>    
        <p>
            The default implementations for those required components are bound by the <code>SpincastDefaultGuiceModule</code> 
            Guice module which is provided by the <code>spincast-default</code> Maven artifact.
        </p>
        <p>
            <i class="subIcon glyphicon glyphicon-share-alt"></i>
            What are those required components and what are the default implementations?
        </p>
        <p>
            <ul>
                <li>
                    <strong><code>IFrontController</code></strong>: this is pretty much the only component that the Spincast's <code>core</code> Guice
                    module, <code>SpincastCoreGuiceModule</code>, binds by itself. Most of the other required components are
                    bound by modules provided by various <a href="/plugins"><code>plugins</code></a>. The default implementation is <code>SpincastFrontController</code>. In general, you don't
                    have to use this component directly.
                </li>
                <li>
                    <strong><code>IServer</code></strong>: the embedded HTTP server. The default implementation, <code>SpincastUndertowServer</code> , 
                    uses the <a href="http://undertow.io">Undertow</a> server and is provided by the 
                    <a href="/plugins/spincast-undertow">Spincast Undertow</a> plugin.
                </li>
                <li>
                    <strong><code>IRouter</code></strong>: the router. The default implementation is
                    <code>SpincastRouter</code>. There is also a <code>IDefaultRouter</code> interface
                    which extends <code>IRouter</code> and parametrizes it with
                    the default request context type, <code>IDefaultRequestContext</code>. All those
                    implementations are provided by the 
                    <a href="/plugins/spincast-routing">Spincast Routing</a> plugin.
                </li>
                <li>
                    <strong><code>ITemplatingEngine</code></strong>: the templating engine to generate <code>HTML</code> and other
                    text containing <em>placeholders</em>. The default implementation, <code>SpincastPebbleTemplatingEngine</code>,
                    uses <a href="http://www.mitchellbosecke.com/pebble/home">Pebble</a> and is provided by the
                    <a href="/plugins/spincast-pebble">Spincast Pebble</a> plugin. 
                </li>
                <li>
                    <strong><code>IJsonManager</code></strong>: to read and write <code>Json</code> content. The
                    default implementation, <code>SpincastJsonManager</code>, uses 
                    <a href="https://github.com/FasterXML/jackson">Jackson</a> as the
                    <code>Json</code> library and is provided by the <a href="/plugins/spincast-jackson-json">Spincast Jackson Json</a> 
                    plugin. 
                </li> 
                <li>
                    <strong><code>IXmlManager</code></strong>: to read and write <code>XML</code> content. The
                    default implementation, <code>SpincastXmlManager</code>, uses 
                    <a href="https://github.com/FasterXML/jackson">Jackson</a> as the
                    <code>XML</code> library and is provided by the <a href="/plugins/spincast-jackson-xml">Spincast Jackson XML</a> 
                    plugin. 
                </li> 
                <li>
                    <strong><code>ISpincastConfig</code></strong>: provides configurations
                    required by Spincast, for example the <code>port</code> on which the server should start. The default implementation,
                    <code>SpincastConfig</code> simply hardcodes default values and is provided by the
                    <a href="/plugins/spincast-config">Spincast Config</a> plugin. 
                </li> 
                <li>
                    <strong><code>ISpincastDictionary</code></strong>: provides some labels
                    Spincast requires, for example the message to display publicly if the default
                    <code>Not Found</code> route is used. The default implementation,
                    <code>SpincastDictionary</code> simply hardcodes english values and is provided by the
                    <a href="/plugins/spincast-dictionary">Spincast Dictionary</a> plugin. 
                </li> 
                <li>
                    <strong><code>ICookieFactory</code></strong> and <strong><code>ICookie</code></strong>: 
                    used to create cookies. The implementations and binding are provided by the
                    <a href="/plugins/spincast-cookies">Spincast Cookies</a> plugin. 
                </li> 
            </ul> 
        </p>
    </div>
    
    {#==========================================
    Section "architecture / Transitive dependencies"
    ==========================================#}
    <div id="dependencies">
        <h4>
            <a class="anchor_small" href="#dependencies" title="permanent link"></a>
            Transitive dependencies
        </h4>
        <p>
            The <code>spincast-core</code> Maven artifact only has 3 direct dependencies which are external to Spincast:
            
            <ul>
                <li>
                    <strong>com.google.inject:*</strong> (Guice), which pulls three transitive dependencies :
                    <ul>
                        <li>
                            <strong>com.google.guava:guava-parent</strong> (Guava)
                        </li>
                        <li>
                            <strong>javax.inject:javax.inject</strong>
                        </li>
                        <li>
                            <strong>aopalliance:aopalliance</strong>
                        </li>
                    </ul>
                </li>
                <li>
                    <strong>com.google.code.findbugs:jsr305</strong> : For the <code>@Nullable</code> annotation.
                </li>
                <li>
                    <strong>org.slf4j:slf4j-api</strong> : The <code>SLF4J</code> logging facade.
                </li>
            </ul>
        </p>   
        <p> 
            The versions used for those dependencies are defined in the <code>spincast-parent</code>
            Maven artifact's <code>pom.xml</code>.
        </p> 
        <p> 
            Spincast core also uses some <a href="https://commons.apache.org/">Apache commons</a> libraries,
            but those are <em>shaded</em>, their classes have been relocated under Spincast's 
            <code>org.spincast.shaded</code> package, so they won't conflit with your own dependencies.
        </p> 
        <p> 
            <i class="subIcon glyphicon glyphicon-share-alt"></i>
            That said, each <a href="/plugins">plugin</a> also adds some more dependencies! If you start with
            the <code>spincast-default</code> Maven artifact, a bunch of transitive dependencies
            will be included. If you need full control over the transitives dependencies added to
            your application, start with the <code>spincast-core</code> Maven artifact and pick, one by one, the
            plugins and implementations you want to use.
        </p> 

    </div>
    
</section>
            