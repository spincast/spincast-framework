{#==========================================
Docs : "Miscellaneous"
==========================================#}

<section id="miscellaneous">
    <h3>
        <a class="anchor" href="#miscellaneous" title="permanent link"></a>
        Miscellaneous
    </h3>
</section>

{#==========================================
Flash Messages
==========================================#}     
<section id="flash_messages">
    <h4>
        <a class="anchor_small" href="#flash_messages" title="permanent link"></a>
        Flash messages
    </h4>
    
    <p>
        A <code>Flash message</code> is a message that is displayed to the user <em>only once</em>.
        It is most of the time used to display
        a confirmation message to the user when a form is submitted and the page
        redirected.
    </p>
    <p>
        A good practice on a website is indeed to redirect the user to a new 
        page when a form has been POSTed and is valid : that way, even if the 
        user refreshes the resulting page, the form
        won't be resubmitted. But this pattern leads to a question : how to display
        a confirmation message on the page the user is redirected to? Flash
        messages are the answer to this question.
    </p>
    <p>
        (All the <a href="/demos-tutorials/html-forms/single-field">Forms &amp; Validation demos</a>
        use <code>Flash messages</code> to display a confirmation message when the Form is
        submitted and is valid... Try them!)
    </p>
    <p>
        <img class="inlineIcon" src="/public/images/icons/para.png" />
        A <code>Flash message</code> is most of the time used to display a confirmation
        (success) message to the user, but it, in fact, supports three "levels" :
        <ul>
            <li>
                <em>Success</em>
            </li>
            <li>
                <em>Warning</em>
            </li>
            <li>
                <em>Error</em>
            </li>
        </ul>
        A Flash message can also have some variables associated with it 
        (in the form of an <code>JsonObject</code>), 
        and those variables can be used when the <code>Flash message</code> is retrieved.  
    </p>
    <p>
        <img class="inlineIcon" src="/public/images/icons/para.png" />
        You can specify a <code>Flash message</code> :
        <ul>
            <li>
                By using the <code>.response().redirect(...)</code> method
                in a <code>Route Handler</code>
                <p>

                    <pre class="ace ace-java"
>public void myHandler(AppRequestContext context) {
    context.response().redirect("/some-url/",
                                FlashMessageLevel.SUCCESS,
                                "The form has been processed successfully.");
}</pre> 
    
            </li>
            <li>
                By throwing a <a class="javadoc" href="/public/javadoc/org/spincast/core/exceptions/RedirectException.html">RedirectException</a>
                    <p>
                    <pre class="ace ace-java"
>public void myHandler(AppRequestContext context) {
    throw new RedirectException("/some-url/",
                                FlashMessageLevel.SUCCESS,
                                "The form has been processed successfully.");
}</pre> 
      
            </li>
        </ul>
    </p>
    <p>
        Of course, it doesn't make sense to specify a <code>Flash message</code>
        when redirecting the user to an external website!
    </p>
    <p>
        <code>Flash messages</code>, when retrieved, are automatically added as a
        global variable for the <code>Templating Engine</code>. It is, in fact, converted to
        an <a href="#alert_messages">Alert message</a>.
    </p>
    <p>
        <img class="inlineIcon" src="/public/images/icons/para.png" />
        How are <code>Flash messages</code> actually implemented? If Spincast 
        has validated that the user supports cookies, it uses one
        to store the "id" of the <code>Flash message</code> and to retrieve it
        on the page the user is redirected to. If cookies are disabled, 
        or if their support has not been validated yet, the "id" of the 
        <code>Flash message</code>is added as a queryString parameter to
        the URL of the page the user is redirected to.
    </p>
   
</section>

{#==========================================
Alert Messages
==========================================#}     
<section id="alert_messages">
    <h4>
        <a class="anchor_small" href="#alert_messages" title="permanent link"></a>
        Alert messages
    </h4>
    
    {% if alertDemoMsg is not empty | default(false) %}
        <p class="alert alert-success">
            <strong>âœ”</strong> {{alertDemoMsg}}
        </p> 
    {% endif %}
    <p>
        An <code>Alert message</code> is a message that has a <code>Success</code>,
        <code>Warning</code> or <code>Error</code> level and that is displayed to 
        the user, usually at the top of the page or of a section. It aims to inform 
        the user about the result of an action, for example.
    </p>
    <p>
        There are multiple ways to display an Alert message on a website.
        The Spincast website uses <a href="http://codeseven.github.io/toastr/">Toastr.js</a>
        when javascript is enabled <span id="taostrDemo"></span>, and a plain
        <code><em>&lt;div&gt;</em></code> when javascript is disabled 
        <code>(<a href="?alert=1#alert_messages"><img class="inlineIcon" src="/public/images/icons/run.png"> Try it!</a>)</code>
    </p>
    <p>
        <img class="inlineIcon" src="/public/images/icons/para.png" />
        An Alert message is simply some text and a level associated with it,
        both added as a templating variable. You can easily implement your own
        way to pass such messages to be displayed to the user, but Spincast suggests a 
        convention and some utilities :
    </p>
    <p>
        <ul>
            <li>
                The Alert messages are provided to the <code>Templating Engine</code>
                 as a variable associated with the <code><em>"spincast.alerts"</em></code> key.
            </li>
            <li>
                There is a dedicated <code>"addAlert(...)"</code> method on the
                <code>response()</code> add-on to easily add one from a <code>Route handler</code> :
                <p>
                <pre class="ace ace-java"
>public void myHandler(AppRequestContext context) {
    context.response().addAlert(AlertLevel.ERROR, 
                                "Your submission is not valid!");
}</pre> 
            </li>
        </ul>
        
        <img class="inlineIcon" src="/public/images/icons/tipy.png" />
        Note that <a href="#flash_messages">Flash messages</a> will be automatically
        converted to Alert messages when it's time to render a template! 
        This means that as long as you add code to display Alert messages in your interface,
        Flash messages will also be displayed properly.
    </p>
   
</section>
   
   
{#==========================================
SSL
==========================================#}     
<section id="ssl">
    <h4>
        <a class="anchor_small" href="#ssl" title="permanent link"></a>
        Using a SSL certificate (HTTPS)
    </h4>
    
    <p>
        It is recommended that you serve your application over <code>HTTPS</code> and
        not <code>HTTP</code>, which is not secure. To achieve that, you need to install a 
        <code>SSL certificate</code>.
    </p>
    <p>
        If you download the <a href="#quick_start">Quick Start</a> application, you will
        find two files explaining the required procedure :
        
        <ul>
            <li>
                <code>/varia/ssl_certificate_howto/self-signed.txt</code>
                <br />
                Shows how to use a <code>self-signed</code> certificate, for development
                purpose.
            </li>
            <li>
                <code>/varia/ssl_certificate_howto/lets-encrypt.txt</code>
                <br />
                Shows how to use a <a href="https://letsencrypt.org/">Let's Encrypt</a> 
                certificate. <code>Let's Encrypt</code> is a provider of <em>free</em>, but totally valid,
                SSL certificates. Instructions in this file will probably work for certificates 
                obtained from other providers, but we haven't tested it yet.
            </li> 
        </ul>
    </p>
</section>

{#==========================================
Spincast Utilities
==========================================#}     
<section id="spincast_utils">
    <h4>
        <a class="anchor_small" href="#spincast_utils" title="permanent link"></a>
        Spincast Utilities
    </h4>
    
    <p>
        Spincast provides some generic utilities, accessible via the 
        <a class="javadoc" href="/public/javadoc/org/spincast/core/utils/SpincastUtils.html">SpincastUtils</a>
        interface :
    </p>
    <p>
        <ul class="apiList">

            <li>
                <code class="apiItem">void <span>zipDirectory</span>(File directoryToZip, File targetZipFile, boolean includeDirItself)</code>
                <div class="well">
                     Zips a directory.
            
                    <div class="apiItemFooter">
                        @param targetZipFile the target .zip file. If the parent directories don't
             exist, tries to create them.
            <br />@param If <code>true</code>, the directory itself will be included in the
             zip file, otherwise only its content will be.
            
                    </div>
                </div>
            </li>
            
            <li>
                <code class="apiItem">void <span>zipExtract</span>(File zipFile, File targetDir)</code>
                <div class="well">
                     Extracts a .zip file to the specified directory.
            
                    <div class="apiItemFooter">
                        @param targetDir The target directory. If it doesn't exist, tried to
             create it (and its parents, if required).
            
                    </div>
                </div>
            </li>
            
            <li>
                <code class="apiItem">String <span>getMimeTypeFromMultipleSources</span>(String responseContentTypeHeader,                                                  String resourcePath,                                                  String requestPath)</code>
                <div class="well">
                     Gets the <code>mime type</code> using multiple sources of information.
            
                    <div class="apiItemFooter">
                        @param contentTypeHeader an already existing Content-Type header on the
             response. Can be null.
            <br />@param resourcePath the path (absolute or relative) to the target resource. Can be null.
            <br />@param requestPath the path of the current request. Can be null.
            <br />@return the <code>mime type</code> or <code>null</code> if it can't be
             decided.
            
                    </div>
                </div>
            </li>
            
            <li>
                <code class="apiItem">String <span>getMimeTypeFromPath</span>(String path)</code>
                <div class="well">
                     Gets the <code>mime type</code> from a path, using its extension.
            
                    <div class="apiItemFooter">
                        @return the <code>mime type</code> or <code>null</code> if it can't be
             decided.
            
                    </div>
                </div>
            </li>
            
            <li>
                <code class="apiItem">String <span>getMimeTypeFromExtension</span>(String extension)</code>
                <div class="well">
                     Gets the <code>mime type</code> from the extension.
            
                    <div class="apiItemFooter">
                        @return the <code>mime type</code> or <code>null</code> if it can't be
             decided.
            
                    </div>
                </div>
            </li>
            
            <li>
                <code class="apiItem">Locale <span>getLocaleBestMatchFromAcceptLanguageHeader</span>(String acceptLanguageHeader)</code>
                <div class="well">
                     Gets the best Locale to use given a "Accept-Language" HTTP header.
            
                    <div class="apiItemFooter">
                        @return the best Locale to use or <code>null</code>
             if the given header can't be parsed.
            
                    </div>
                </div>
            </li>
            
            <li>
                <code class="apiItem">boolean <span>isContentTypeToSkipGziping</span>(String contentType)</code>
                <div class="well">
                     Should the specified <code>Content-Type</code> be gzipped?
            
                </div>
            </li>
            
            <li>
                <code class="apiItem">File <span>getAppJarDirectory</span>()</code>
                <div class="well">
                     Returns the working directory: the directory
             in which the executable .jar is located.
            
                    <div class="apiItemFooter">
                        @return the working directory or <code>null</code> if the application is
             running inside an IDE.
            
                    </div>
                </div>
            </li>
            
            <li>
                <code class="apiItem">String <span>getSpincastCurrentVersion</span>()</code>
                <div class="well">
                     Gets the current Spincast version.
            
                </div>
            </li>
            
            <li>
                <code class="apiItem">String <span>getCacheBusterCode</span>()</code>
                <div class="well">
                     The cache buster to use.
             <p>
             This should probably change each time
             the application is restarted or at least redeployed.
             </p>
             <p>
             It should also be in such a format that it's possible to
             remove it from a given text.
             </p>
             <p>
             This must be kept in sync with
             <code>removeCacheBusterCode</code>!
             </p>
            
                </div>
            </li>
            
            <li>
                <code class="apiItem">String <span>removeCacheBusterCodes</span>(String text)</code>
                <div class="well">
                     Removes the cache buster code occurences from the
             given text.
             <p>
             Note that this won't simply remove the <em>current</em>
             cache busting code, it will remove <em>any</em> valid cache busting code...
             This is what we want since we don't want a client sending a request
             containing an old cache busting code to break!
             </p>
             <p>
             This must be kept in sync with
             <code>getCacheBusterCode</code>!
             </p>
            
                </div>
            </li> 
            
            <li>
                <code class="apiItem">String <span>readClasspathFile</span>(String path)</code>
                <div class="well">
                    <p>
                        Reads a file on the classpath and returns it as a
                        String.
                    </p>
                    <p>
                        Paths are always considered from the root at the classpath.
                        You can start the path with a "/" or not, it makes no difference.
                    </p>
                    <p>
                        Uses <code>UTF-8</code> by default.
                    </p>
                    <p class="apiItemFooter">
                        @return the content of the file or <code>null</code>
                        if not found.
                    </p>
                </div>
            </li> 
        </ul>
    </p> 

</section>


{#==========================================
@MainArgs
==========================================#}     
<section id="main_args">
    <h4>
        <a class="anchor_small" href="#main_args" title="permanent link"></a>
        @MainArgs
    </h4>
    
    <p>
        The <code>init(...)</code> method of the <a href="#boot_bootstrapper">Bootstrapper</a> allows you
        to bind the arguments received in your <code>main(...)</code> method. For example :
    </p>
    <p>
        <div>
            <p>
                <pre class="ace ace-java" data-ace-hi="1,24,1,37|5,12,5,27"
>

public static void main(String[] args) {

    Spincast.configure()
            .module(new AppModule())
            .init(args);
    //....
}</pre> 
            </p>
        </div>
    </p>   
    <p>
        By doing so, those arguments will be available for injection, using the <code>@MainArgs</code>
        annotation :
    </p>
    <p>
        <div>
            <p>
                <pre class="ace ace-java" data-ace-hi="5,21,5,48"
>public class AppConfig extends SpincastConfig implements AppConfig {

    private final String[] mainArgs;

    @Inject
    public AppConfig(@MainArgs String[] mainArgs) {
        this.mainArgs = mainArgs;
    }

    protected String[] getMainArgs() {
        return this.mainArgs;
    }

    @Override
    public int getHttpServerPort() {

        int port = super.getHttpServerPort();
        if(getMainArgs().length &gt; 0) {
            port = Integer.parseInt(getMainArgs()[0]);
        }
        return port;
    }
}</pre> 
            </p>
        </div>
    </p>   
    
</section>

{#==========================================
Using an init() method
==========================================#}     
<section id="init_method">
    <h4>
        <a class="anchor_small" href="#init_method" title="permanent link"></a>
        Using an <code>init()</code> method
    </h4>
    
    <p>
        This is more about standard Guice development than about Spincast, but we
        feel it's a useful thing to know.
    </p>
    <p>
        Guice doesn't provide
        support for a <code>@PostConstruct</code> annotation out of the box.
        And since it is often seen as a bad practice to do too much work directly in a constructor, what we want
        is an <code>init()</code> method to be called <em>once the
        object it fully constructed</em>, and do the initialization work there. 
    </p>
    <p>
        The trick is that Guice calls any <code>@Inject</code> annotated methods
        once the object is created, so let's use this to our advantage :
    </p>
    <p>
        <div>
            <p>
                <pre class="ace ace-java"
>public class UserService implements UserService {

    private final SpincastConfig spincastConfig;

    @Inject
    public UserService(SpincastConfig spincastConfig) {
        this.spincastConfig = spincastConfig;
    }

    @Inject
    protected void init() {
        doSomeValidation();
        doSomeInitialization();
    }

    //...
}</pre> 
            </p>
            <p>
                <span class="explanation">Explanation :</span>
                <ul>
                    <li>
                        <span class="code-line-nbr">5-8</span> : The constructor's job is only to
                        receive the dependencies.
                    </li>
                    <li>
                        <span class="code-line-nbr">10-14</span> : An <code>init()</code> method is
                        also annotated with <code>@Inject</code>. This method will be called once the
                        object is fully constructed. This is a good place to do some initialization work!
                    </li>
                </ul>
            </p> 
        </div>
    </p>   
    <p>
        What we recommend is <em>constructor injection</em> + one (and only one) <code>@Inject</code> 
        annotated method. The problem with multiple <code>@Inject</code> annotated methods (other than 
        constructors) is that it's hard to know in which order they will be called.
    </p>   
    <p>
        Finally, if the <code>init()</code> method must be called <em>as soon as the application starts</em>, make sure
        you bind the object using
        <a href="https://github.com/google/guice/wiki/Scopes#eager-singletons">asEagerSingleton()</a>!
    </p>
    
</section>        
            
            